{% extends '/pages/base.html' %}

{% block title %}Recherche d'objets trouvÃ©s{% endblock %}

{% block content %}

<h1 class="my-3 text-center">Recherche d'objets trouvÃ©s</h1>
<p class="my-3">
    Vous avez Ã©garÃ© quelque chose en gare ou durant un trajet ? Pas de panique, ce formulaire est lÃ  pour vous aider !<br/>    
    ğŸ‘œ Type dâ€™objet<br/>
    Commencez par sÃ©lectionner le type dâ€™objet perdu dans la liste dÃ©roulante.<br/>
    
    ğŸš‰ Gare(s) concernÃ©e(s)<br/>
    
        Si vous savez oÃ¹ vous avez perdu votre objet, choisissez une seule gare.<br/>
    
        Si vous lâ€™avez perdu en voyage, sÃ©lectionnez la gare de dÃ©part et celle dâ€™arrivÃ©e.<br/>
        Tapez le nom dâ€™une gare, laissez-vous guider par lâ€™autocomplÃ©tion, et cliquez dessus pour la valider. Elle sâ€™affichera en dessous avec une croix pour la retirer si besoin.<br/>
    
    ğŸ“… Date du trajet<br/>
    Indiquez la date Ã  laquelle vous avez perdu votre objet.<br/>
    
    â³ Heure approximative de perte<br/>
    Pas besoin dâ€™Ãªtre prÃ©cis Ã  la minute prÃ¨s ! Une estimation suffira.<br/>
    
    ğŸ’¡ Une fois le formulaire soumis, vous pourrez voir combien dâ€™objets du type sÃ©lectionnÃ© ont Ã©tÃ© retrouvÃ©s dans la ou les gares choisies, depuis la date et lâ€™heure indiquÃ©es jusquâ€™Ã  la fin des vacances de NoÃ«l 2024. Bonne recherche ! ğŸ„ğŸ”
</p>

<!-- Affichage des messages flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="alert-container mt-3 text-center mx-5">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

{% include '/partials/formulaires/form_trouver_objet.html' %}

<script>
    document.querySelector("form").addEventListener("submit", function() {
    console.log("Valeur des gares soumises :", document.getElementById("hidden-gares").value);
    });
</script>

<div class="m-5">
    <div id="map" style="height: 400px; width: 100%;"></div>
    {% include '/partials/scripts/script_carte_leaflet.html' %}
</div>

<div class="m-5 container-fluid justify-content-around w-100">

    <!-- Affichage des donnÃ©es des gares -->
    
    {% if donnees %}
        <div class="text-center">
            <h1>RÃ©sultats</h1>
        </div>
        <div class="row">
            <div class="col-6"></div>
                <!-- ItÃ©ration sur la liste de dictionnaires donnees -->
                {% for gare in donnees %}
                <div>
                <h2>{{ gare.nom }}</h2>
                <button class="ajout-favoris-btn btn" data-uic="{{ gare.UIC }}">Ajouter aux favoris</button>
                <p><strong>Adresse</strong> : {{ gare.adresse }}</p>
                <p><strong>Nombre d'objets trouvÃ©s pendant la pÃ©riode</strong> : {{ gare.nb_objets_trouves_periode_perte_type }}</p>
            </div>
            
            <div class="col-6">
                <!-- Affichage des horaires seulement si la gare en a -->
                {% if gare.horaires %}
                <h3>Horaires</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Jour</th>
                            <th>Horaires (Jour Normal)</th>
                            <th>Horaires (Jour FÃ©riÃ©)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for jour, horaires in gare.horaires.items() %}
                            <tr>
                                <td>{{ jour }}</td>
                                <td>{{ horaires.horaires_jour_normal }}</td>
                                <td>{{ horaires.horaires_jour_ferie }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>

            <!-- Graphique de rÃ©partition des objets trouvÃ©s par type pour la gare itÃ©rÃ©e-->
        <div class="row" style="width:90%">
            {% if gare.nb_objets_trouves_periode_perte_type > 0 %}
            <div class="col-6">
                <h3>RÃ©partition des objets trouvÃ©s par type - {{ gare.nom }}</h3>
                <div>
                    <canvas id="graphiqueCamembert_{{ gare.UIC }}" style="width: 100%; max-width: 800px; height: 400px;"></canvas>
                </div>
            </div>
            {% endif %}

        {% endfor %}
        <!-- Inclusion du script pour le graphique camembert -->
        {% include '/partials/graphiques/graphique_1_camembert.html' %}

        <!-- Graphique des objets trouvÃ©s par type, par rÃ©gion -->
        
        <div class="col-6">
            <h3>RÃ©partition des objets trouvÃ©s par type {{ data_objets_par_types_gares.gare }}</h3>
            <div>
                <canvas id="graphique1Barres" style="width: 800px; height: 600px;"></canvas>
            </div>
        </div>
    {% include '/partials/graphiques/graphique_2_barres.html' %}
{% endif %}

</div>
</div>
{% endblock %}